    1  k get no
    2  k get po
    3  k get po,ns,rs,ds,deploy
    4  k get rs
    5  k get po,ns,rs,ds,deploy -n A
    6  k get po,ns,rs,ds,deploy -n all
    7  k get po,ns,rs,ds,deploy -namespace all
    8  k get po,ns,rs,ds,deploy -A
    9  k get po,ns,rs,ds,deploy,svc -A
   10  k get po,ns,rs,ds,deploy,svc,vl -A
   11  k get po,ns,rs,ds,deploy,svc,vol -A
   12  k get po,ns,rs,ds,deploy,svc -A
   13  git clone https://github.com/sivakumaranrg/chatgpt_mentor-mode.git
   14  cd chatgpt_mentor-mode
   15  kubectl create ns lab
   16  kubectl config set-context --current --namespace=lab
   17  kubectl apply -f deploy/deploy-web.yaml
   18  kubectl apply -f deploy/svc-web.yaml
   19  kubectl rollout status deploy/web
   20  kubectl config set-context --current --namespace=lab
   21  mkdir -p config
   22  cat > config/web-configmap.yaml << 'EOF'
apiVersion: v1
kind: ConfigMap
metadata:
  name: web-config
data:
  WELCOME_MSG: "Hello from K8s - Day2"
EOF

   23  cat > config/web-secret.yaml << 'EOF'
apiVersion: v1
kind: Secret
metadata:
  name: web-secret
type: Opaque
stringData:
  API_KEY: "dummy-key"
EOF

   24  cat > deploy/deploy-web.yaml << 'EOF'
apiVersion: apps/v1
kind: Deployment
metadata:
  name: web
spec:
  replicas: 2
  selector:
    matchLabels:
      app: web
  template:
    metadata:
      labels:
        app: web
    spec:
      containers:
      - name: nginx
        image: nginx:1.27
        ports:
        - containerPort: 80
        env:
        - name: WELCOME_MSG
          valueFrom:
            configMapKeyRef:
              name: web-config
              key: WELCOME_MSG
        - name: API_KEY
          valueFrom:
            secretKeyRef:
              name: web-secret
              key: API_KEY
        readinessProbe:
          httpGet: { path: /, port: 80 }
          initialDelaySeconds: 5
          periodSeconds: 5
        livenessProbe:
          httpGet: { path: /, port: 80 }
          initialDelaySeconds: 15
          periodSeconds: 10
EOF

   25  kubectl apply -f config/web-configmap.yaml
   26  kubectl apply -f config/web-secret.yaml
   27  kubectl apply -f deploy/deploy-web.yaml
   28  kubectl rollout status deploy/web
   29  kubectl describe deploy web | egrep -n 'Readiness|Liveness'
   30  kubectl exec deploy/web -- printenv | egrep 'WELCOME_MSG|API_KEY'
   31  kubectl run curl --image=busybox:1.36 --restart=Never --command -- sh -c "wget -qO- http://web"
   32  kubectl logs curl | head -n 5
   33  kubectl delete pod curl
   34  kubectl get all
   35  printf "\n## Day 2\nkubectl apply -f config/web-configmap.yaml\nkubectl apply -f config/web-secret.yaml\nkubectl apply -f deploy/deploy-web.yaml\nkubectl rollout status deploy/web\n" >> README.md
   36  git add .
   37  git commit -m "Day 2: ConfigMap, Secret, readiness/liveness probes"
   38  git push
   39  git status
   40  git commit -m "Day 2: ConfigMap, Secret, readiness/liveness probes"
   41  git config user.name "Sivakumaran RG"
   42  git config user.email "sivakumaranrg@gmail.com"
   43  git commit -m "Day 2: ConfigMap, Secret, readiness/liveness probes"
   44  git push
   45  k get all
   46  # 1) Probes exist?
   47  kubectl describe deploy web | egrep -n 'Readiness|Liveness|Probe'
   48  # 2) Config injected?
   49  kubectl exec deploy/web -- printenv | egrep 'WELCOME_MSG|API_KEY'
   50  # 3) Inside-cluster HTTP check
   51  kubectl run curl --image=busybox:1.36 --restart=Never --command -- sh -c "wget -qO- http://web"
   52  kubectl logs curl | head -n 5
   53  kubectl delete pod curl
   54  # (optional sanity that objects exist)
   55  kubectl get cm web-config -o yaml | head -n 20
   56  kubectl get secret web-secret -o yaml | head -n 10
   57  kubectl delete pod curl --ignore-not-found
   58  kubectl run curl --image=busybox:1.36 --restart=Never --command -- sh -c "wget -qO- http://web && sleep 1"
   59  kubectl wait --for=condition=Ready pod/curl --timeout=60s
   60  kubectl logs curl | head -n 5
   61  kubectl delete pod curl
   62  kubectl logs curl | head -n 5
   63  kubectl delete pod curl --ignore-not-found
   64  kubectl run curl --image=busybox:1.36 --restart=Never --command -- sh -c "wget -qO- http://web && sleep 1"
   65  kubectl wait --for=condition=Ready pod/curl --timeout=60s
   66  kubectl logs curl | head -n 5
   67  history
   68  date && /n history > day2.txt
   69  date && history > day2.txt
